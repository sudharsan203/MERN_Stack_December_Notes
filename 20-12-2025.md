# CRUD Operations

## Overview
CRUD stands for **Create, Read, Update, Delete** - the four basic operations for persistent storage and data manipulation. These operations form the foundation of most database and API interactions.

---

## HTTP Methods for CRUD Operations

| CRUD Operation | HTTP Method | Purpose |
|---------------|-------------|---------|
| Create | POST | Create new resources |
| Read | GET | Retrieve/Read resources |
| Update | PUT/PATCH | Update existing resources |
| Delete | DELETE | Remove resources |

---

## 1. GET (Read)

### Purpose
Retrieve data from the server without modifying it. GET requests are **idempotent** and **safe** - they should not change server state.

### Characteristics
- **Safe**: Does not modify data
- **Idempotent**: Multiple identical requests produce the same result
- **Cacheable**: Responses can be cached
- **Parameters**: Sent via URL query strings

### Syntax
```http
GET /mobileslist HTTP/1.1
Host: localhost:3000
```

### Use Cases
- Fetch all records: `GET /mobileslist`
- Fetch a specific record: `GET /mobileslist/1`
- Search/Filter: `GET /mobileslist?brand=Apple&model=iPhone`

### Response Codes
- **200 OK**: Success
- **404 Not Found**: Resource doesn't exist
- **401 Unauthorized**: Authentication required

### Example
```javascript
// Fetch all mobiles
fetch('http://localhost:3000/mobileslist')
  .then(response => response.json())
  .then(data => console.log(data));

// Fetch specific mobile
fetch('http://localhost:3000/mobileslist/1')
  .then(response => response.json())
  .then(mobile => console.log(mobile));
```

---

## 2. POST (Create)

### Purpose
Create new resources on the server. POST requests are **not idempotent** - multiple identical requests may create multiple resources.

### Characteristics
- **Not Safe**: Modifies server state
- **Not Idempotent**: Multiple requests may create multiple resources
- **Not Cacheable**: Typically not cached
- **Parameters**: Sent in request body

### Syntax
```http
POST /addmobile HTTP/1.1
Host: localhost:3000
Content-Type: application/json

{
  "brand": "OnePlus",
  "model": "11 Pro"
}
```

### Use Cases
- Create new record: `POST /addmobile`
- Submit form data
- Upload files
- Trigger actions

### Response Codes
- **201 Created**: Resource successfully created
- **200 OK**: Success (alternative)
- **400 Bad Request**: Invalid data
- **409 Conflict**: Resource already exists

### Example
```javascript
// Create new mobile
fetch('http://localhost:3000/addmobile', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    brand: 'OnePlus',
    model: '11 Pro'
  })
})
  .then(response => response.json())
  .then(data => console.log('Mobile created:', data));
```

---

## 3. PUT (Update/Replace)

### Purpose
Update or replace an existing resource completely. PUT requests are **idempotent** - multiple identical requests produce the same result.

### Characteristics
- **Not Safe**: Modifies server state
- **Idempotent**: Multiple identical requests have the same effect
- **Not Cacheable**: Typically not cached
- **Complete Replacement**: Replaces entire resource

### Syntax
```http
PUT /updatemobile/1 HTTP/1.1
Host: localhost:3000
Content-Type: application/json

{
  "brand": "Apple",
  "model": "iPhone 15 Pro"
}
```

### Use Cases
- Update entire record: `PUT /updatemobile/1`
- Replace resource completely
- Create resource at specific URI (if allowed)

### Response Codes
- **200 OK**: Successfully updated
- **204 No Content**: Updated without response body
- **404 Not Found**: Resource doesn't exist
- **400 Bad Request**: Invalid data

### Example
```javascript
// Update mobile completely
fetch('http://localhost:3000/updatemobile/1', {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    brand: 'Apple',
    model: 'iPhone 15 Pro'
  })
})
  .then(response => response.json())
  .then(data => console.log('Mobile updated:', data));
```

### PUT vs PATCH
- **PUT**: Replaces entire resource (all fields required)
- **PATCH**: Partial update (only modified fields needed)

```javascript
// PATCH - Partial Update
fetch('http://localhost:3000/updatemobile/1', {
  method: 'PATCH',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    model: 'iPhone 15 Pro Max'  // Only update model field
  })
});
```

---

## 4. DELETE (Delete)

### Purpose
Remove a resource from the server. DELETE requests are **idempotent** - multiple identical requests have the same effect.

### Characteristics
- **Not Safe**: Modifies server state
- **Idempotent**: Deleting same resource multiple times has same effect
- **Not Cacheable**: Not cached

### Syntax
```http
DELETE /deletemobile/1 HTTP/1.1
Host: localhost:3000
```

### Use Cases
- Delete specific record: `DELETE /deletemobile/1`
- Remove resources
- Clear data

### Response Codes
- **200 OK**: Deleted with response body
- **204 No Content**: Deleted without response body
- **404 Not Found**: Resource doesn't exist
- **403 Forbidden**: Not allowed to delete

### Example
```javascript
// Delete mobile
fetch('http://localhost:3000/deletemobile/1', {
  method: 'DELETE'
})
  .then(response => {
    if (response.ok) {
      console.log('Mobile deleted successfully');
    }
  });
```

---

## Complete CRUD Example

### Mobile E-Commerce API - Node.js/Express Server

This real-world example demonstrates a complete CRUD API for managing mobile phones inventory with MongoDB integration.

```javascript
const express = require("express");
const { MongoClient } = require('mongodb');

const app = express();
const PORT = 3000;

// MongoDB connection setup
const uri = "mongodb://localhost:27017";
const client = new MongoClient(uri);

async function testConnection() {
  try {
    await client.connect();
    console.log("Connected to MongoDB successfully!");
    
    const db = client.db("MobileECommerce");
    const collections = await db.listCollections().toArray();
    console.log("Collections:", collections);
  } catch (error) {
    console.error("Connection failed:", error);
  } finally {
    await client.close();
  }
}

testConnection();

// In-memory data store
let mobiles = [
  { id: 1, brand: "Apple", model: "iPhone 13" },
  { id: 2, brand: "Samsung", model: "Galaxy S21" },
  { id: 3, brand: "Google", model: "Pixel 6" }
];

// Root endpoint
app.get("/", (req, res) => {
  res.send("Hello, Secure World!");
});

// Health check endpoint
app.get("/healthCheck", (req, res) => {
  let response = {
    name: "Success",
    message: "Server is healthy"
  };
  res.send(response);
});

// READ - Get all mobiles
app.get("/mobileslist", (req, res) => {
  res.send(mobiles);
});

// CREATE - Add new mobile
app.post("/addmobile", express.json(), (req, res) => {
  console.log("Req Information", req.body, req.url, req.method);
  
  const newMobile = {
    id: mobiles.length + 1,
    brand: req.body.brand,
    model: req.body.model
  };
  
  mobiles.push(newMobile);
  res.send({ 
    message: "Mobile added successfully", 
    mobilesList: mobiles 
  });
});

// UPDATE - Update existing mobile
app.put("/updatemobile/:id", express.json(), (req, res) => {
  const mobileId = parseInt(req.params.id);
  const mobile = mobiles.find(m => m.id === mobileId);
  
  if (mobile) {
    mobile.brand = req.body.brand || mobile.brand;
    mobile.model = req.body.model || mobile.model;
    res.send({ 
      message: "Mobile updated successfully", 
      mobile 
    });
  } else {
    res.status(404).send({ message: "Mobile not found" });
  }
});

// DELETE - Remove mobile
app.delete("/deletemobile/:id", (req, res) => {
  const mobileId = parseInt(req.params.id);
  const index = mobiles.findIndex(m => m.id === mobileId);
  
  if (index !== -1) {
    mobiles.splice(index, 1);
    res.send({ 
      message: "Mobile deleted successfully", 
      mobilesList: mobiles 
    });
  } else {
    res.status(404).send({ message: "Mobile not found" });
  }
});

app.listen(PORT, () => {
  console.log(`Server is running on http://localhost:${PORT}`);
});
```

### API Testing Examples

**Health Check:**
```http
GET http://localhost:3000/healthCheck
```

**READ - Get all mobiles:**
```http
GET http://localhost:3000/mobileslist
```

**CREATE - Add new mobile:**
```http
POST http://localhost:3000/addmobile
Content-Type: application/json

{
  "brand": "OnePlus",
  "model": "9 Pro"
}
```

**UPDATE - Update mobile:**
```http
PUT http://localhost:3000/updatemobile/1
Content-Type: application/json

{
  "brand": "Apple",
  "model": "iPhone 14 Pro"
}
```

**DELETE - Remove mobile:**
```http
DELETE http://localhost:3000/deletemobile/2
```

---

## Best Practices

### 1. **Use Appropriate HTTP Methods**
- Don't use GET for operations that modify data
- Don't use POST for simple data retrieval

### 2. **Follow RESTful Conventions**
- Use plural nouns for collections: `/mobiles` not `/mobile`
- Use hierarchical structure: `/mobiles/1/reviews`

### 3. **Return Appropriate Status Codes**
- 2xx for success
- 4xx for client errors
- 5xx for server errors

### 4. **Idempotency**
- GET, PUT, DELETE should be idempotent
- POST is typically not idempotent

### 5. **Security**
- Validate input data
- Implement authentication & authorization
- Use HTTPS for sensitive data
- Prevent SQL injection and XSS attacks

### 6. **Error Handling**
```javascript
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Something went wrong!' });
});
```

### 7. **Versioning**
- Use API versioning: `/api/v1/mobiles`
- Maintain backward compatibility

---

## Summary

| Method | CRUD | Idempotent | Safe | Purpose |
|--------|------|------------|------|---------|
| GET | Read | ✅ | ✅ | Retrieve data |
| POST | Create | ❌ | ❌ | Create new resource |
| PUT | Update | ✅ | ❌ | Replace entire resource |
| PATCH | Update | ❌ | ❌ | Partial update |
| DELETE | Delete | ✅ | ❌ | Remove resource |
